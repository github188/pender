(function(F,G){var A=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;var C=window.IDBKeyRange||window.webkitIDBKeyRange;var E=window.IDBCursor||window.webkitIDBCursor||{};if(typeof E.PREV==="undefined"){E.PREV="prev"}if(typeof E.NEXT==="undefined"){E.NEXT="next"}var D=window.IDBTransaction||window.webkitIDBTransaction;function B(I){var H=null;switch(I){case 0:case 1:case"readwrite":case"readonly":H=I;break;default:H=D.READ_WRITE||"readwrite"}return H}F.extend({indexedDB:function(N,K){if(K){if(typeof K==="number"){K={version:K}}var J=K.version;if(K.schema&&!J){var I=-1;for(var L in K.schema){I=I>L?I:L}J=K.version||I}}var M={request:function(P,O){return F.Deferred(function(Q){try{var R=typeof P==="function"?P(O):P;R.onsuccess=function(T){Q.resolveWith(R,[R.result,T])};R.onerror=function(T){Q.rejectWith(R,[R.error,T])};if(typeof R.onblocked!=="undefined"&&R.onblocked===null){R.onblocked=function(U){var T;try{T=R.result}catch(U){T=null}Q.notifyWith(R,[T,U])}}if(typeof R.onupgradeneeded!=="undefined"&&R.onupgradeneeded===null){R.onupgradeneeded=function(T){Q.notifyWith(R,[R.result,T])}}}catch(S){S.name="exception";Q.rejectWith(R,["exception",S])}})},transaction:function(O){return{objectStore:function(P){try{return M.objectStore(O.objectStore(P))}catch(Q){O.readyState!==O.DONE&&O.abort();return M.objectStore(null)}},createObjectStore:function(Q,P){try{return M.objectStore(O.db.createObjectStore(Q,P))}catch(R){O.readyState!==O.DONE&&O.abort()}},deleteObjectStore:function(P){try{O.db.deleteObjectStore(P)}catch(Q){O.readyState!==O.DONE&&O.abort()}},abort:function(){O.abort()}}},objectStore:function(P){var O={};var R=["add","put","get","delete","clear","count"];for(var Q=0;Q<R.length;Q++){O[R[Q]]=(function(S){return function(){return M.request(function(T){return P[S].apply(P,T)},arguments)}})(R[Q])}O.each=function(U,S,T){return M.cursor(function(){if(T){return P.openCursor(M.range(S),T)}else{return P.openCursor(M.range(S))}},U)};O.index=function(S){return M.index(function(){return P.index(S)})};O.createIndex=function(U,S,T){if(arguments.length===2&&typeof S==="string"){T=arguments[1];S=null}if(!T){T=U}return M.index(function(){return P.createIndex(T,U,S)})};O.deleteIndex=function(S){return P.deleteIndex(S)};return O},range:function(O){if(F.isArray(O)){if(O.length===1){return C.only(O[0])}else{return C.bound(O[0],O[1],(typeof O[2]==="undefined")?false:O[2],(typeof O[3]==="undefined")?false:O[3])}}else{if(typeof O==="undefined"){return null}else{return O}}},cursor:function(P,O){return F.Deferred(function(Q){try{var R=typeof P==="function"?P():P;R.onsuccess=function(V){if(!R.result){Q.resolveWith(R,[null,V]);return}var U={"delete":function(){return M.request(function(){return R.result["delete"]()})},update:function(W){return M.request(function(){return R.result.update(W)})},next:function(W){this.data=W},key:R.result.key,value:R.result.value};Q.notifyWith(R,[U,V]);var T=O.apply(R,[U]);try{if(T===false){Q.resolveWith(R,[null,V])}else{if(typeof T==="number"){R.result.advance.apply(R.result,[T])}else{if(U.data){R.result["continue"].apply(R.result,[U.data])}else{R.result["continue"]()}}}}catch(V){Q.rejectWith(R,[R.result,V])}};R.onerror=function(T){Q.rejectWith(R,[R.result,T])}}catch(S){S.type="exception";Q.rejectWith(R,[null,S])}})},index:function(P){try{var O=(typeof P==="function"?P():P)}catch(Q){O=null}return{each:function(T,R,S){return M.cursor(function(){if(S){return O.openCursor(M.range(R),S)}else{return O.openCursor(M.range(R))}},T)},eachKey:function(T,R,S){return M.cursor(function(){if(S){return O.openKeyCursor(M.range(R),S)}else{return O.openKeyCursor(M.range(R))}},T)},get:function(R){if(typeof O.get==="function"){return M.request(O.get(R))}else{return O.openCursor(M.range(R))}},count:function(){if(typeof O.count==="function"){return M.request(O.count())}else{throw"Count not implemented for cursors"}},getKey:function(R){if(typeof O.getKey==="function"){return M.request(O.getKey(R))}else{return O.openKeyCursor(M.range(R))}}}}};var H=M.request(function(){return J?A.open(N,parseInt(J)):A.open(N)});H.then(function(O,P){O.onversionchange=function(){if(!(K&&K.onversionchange&&K.onversionchange()!==false)){O.close()}}},function(O,P){},function(O,Q){if(Q&&Q.type==="upgradeneeded"){if(K&&K.schema){for(var P=Q.oldVersion+1;P<=Q.newVersion;P++){typeof K.schema[P]==="function"&&K.schema[P].call(this,M.transaction(this.transaction))}}if(K&&typeof K.upgrade==="function"){K.upgrade.call(this,M.transaction(this.transaction))}}});return F.extend(H,{cmp:function(P,O){return A.cmp(P,O)},deleteDatabase:function(){return F.Deferred(function(O){H.then(function(P,Q){P.close();M.request(function(){return A.deleteDatabase(N)}).then(function(R,S){O.resolveWith(this,[R,S])},function(R,S){O.rejectWith(this,[R,S])},function(R,S){O.notifyWith(this,[R,S])})},function(P,Q){O.rejectWith(this,[P,Q])},function(P,Q){O.notifyWith(this,[P,Q])})})},transaction:function(O,P){!F.isArray(O)&&(O=[O]);P=B(P);return F.Deferred(function(Q){H.then(function(R,T){var S;try{S=R.transaction(O,P);S.onabort=S.onerror=function(U){Q.rejectWith(S,[U])};S.oncomplete=function(U){Q.resolveWith(S,[U])}}catch(T){T.type="exception";Q.rejectWith(this,[T]);return}try{Q.notifyWith(S,[M.transaction(S)])}catch(T){T.type="exception";Q.rejectWith(this,[T])}},function(R,S){Q.rejectWith(this,[S,R])},function(R,S){})})},objectStore:function(U,S){var T=this,W={};function R(X){return F.Deferred(function(Y){function Z(a,c){try{c(a.objectStore(U)).then(function(d,f){Y.resolveWith(this,[d,f])},function(d,f){Y.rejectWith(this,[d,f])})}catch(b){b.name="exception";Y.rejectWith(a,[b,b])}}T.transaction(U,B(S)).then(function(){},function(b,c){if(b.code===b.NOT_FOUND_ERR&&(S===true||typeof S==="object")){var a=this.result;a.close();H=M.request(function(){return A.open(N,(parseInt(a.version,10)||1)+1)});H.then(function(d,f){d.onversionchange=function(){if(!(K&&K.onversionchange&&K.onversionchange()!==false)){d.close()}};T.transaction(U,B(S)).then(function(){},function(g,h){Y.rejectWith(this,[g,h])},function(g,h){Z(g,X)})},function(d,f){Y.rejectWith(this,[d,f])},function(d,g){if(g.type==="upgradeneeded"){try{d.createObjectStore(U,S===true?{autoIncrement:true}:S)}catch(f){Y.rejectWith(this,[f,g])}}})}else{Y.rejectWith(this,[b,c])}},function(a){Z(a,X)})})}function P(X,Y){return R(function(Z){return Z[X].apply(Z,Y)})}function O(X,Z,Y){return R(function(b){var a=b.index(Z);return a[X].apply(a[X],Y)})}var V=["add","delete","get","put","clear","count","each"];for(var Q=0;Q<V.length;Q++){W[V[Q]]=(function(X){return function(){return P(X,arguments)}})(V[Q])}W.index=function(X){return{each:function(a,Y,Z){return O("each",X,[a,Y,Z])},eachKey:function(a,Y,Z){return O("eachKey",X,[a,Y,Z])},get:function(Y){return O("get",X,[Y])},count:function(){return O("count",X,[])},getKey:function(Y){return O("getKey",X,[Y])}}};return W}})}});F.indexedDB.IDBCursor=E;F.indexedDB.IDBTransaction=D;F.idb=F.indexedDB})(jQuery);
