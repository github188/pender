$.extend($.fn.datagrid.defaults,{rowHeight:25,onBeforeFetch:function(A){},onFetch:function(B,A){}});var bufferview=$.extend({},$.fn.datagrid.defaults.view,{render:function(L,E,A){var D=$.data(L,"datagrid");var B=D.options;var P=this.rows||[];if(!P.length){return}var J=$(L).datagrid("getColumnFields",A);if(A){if(!(B.rownumbers||(B.frozenColumns&&B.frozenColumns.length))){return}}var K=parseInt(B.finder.getTr(L,"","last",(A?1:2)).attr("datagrid-row-index"))+1||0;var N=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var H=0;H<P.length;H++){var I=B.rowStyler?B.rowStyler.call(L,K,P[H]):"";var F="";var O="";if(typeof I=="string"){O=I}else{if(I){F=I["class"]||"";O=I.style||""}}var M='class="datagrid-row '+(K%2&&B.striped?"datagrid-row-alt ":" ")+F+'"';var C=O?'style="'+O+'"':"";var G=D.rowIdPrefix+"-"+(A?1:2)+"-"+K;N.push('<tr id="'+G+'" datagrid-row-index="'+K+'" '+M+" "+C+">");N.push(this.renderRow.call(this,L,J,A,K,P[H]));N.push("</tr>");K++}N.push("</tbody></table>");$(E).append(N.join(""))},onBeforeRender:function(G){var D=$.data(G,"datagrid");var C=D.options;var B=D.dc;var A=this;this.renderedCount=0;this.rows=[];B.body1.add(B.body2).empty();H();function H(){D.onLoadSuccess=C.onLoadSuccess;C.onLoadSuccess=function(){};setTimeout(function(){B.body2.unbind(".datagrid").bind("scroll.datagrid",function(I){if(D.onLoadSuccess){C.onLoadSuccess=D.onLoadSuccess;D.onLoadSuccess=undefined}if(A.scrollTimer){clearTimeout(A.scrollTimer)}A.scrollTimer=setTimeout(function(){F.call(A)},50)});B.body2.triggerHandler("scroll.datagrid")},0)}function F(){if(E()<B.body2.height()&&A.renderedCount<D.data.total){this.getRows.call(this,G,function(I){this.rows=I;this.populate.call(this,G);B.body2.triggerHandler("scroll.datagrid")})}else{if(B.body2.scrollTop()>=E()-B.body2.height()){this.getRows.call(this,G,function(I){this.rows=I;this.populate.call(this,G)})}}}function E(){return A.renderedCount*C.rowHeight}},getRows:function(E,G){var B=$.data(E,"datagrid");var A=B.options;var F=Math.floor(this.renderedCount/A.pageSize)+1;if(this.renderedCount>=B.data.total){return}if(A.onBeforeFetch.call(E,F)==false){return}var D=(F-1)*A.pageSize;var I=B.data.rows.slice(D,D+A.pageSize);if(I.length){A.onFetch.call(E,F,I);G.call(this,I)}else{var C=$.extend({},A.queryParams,{page:Math.floor(this.renderedCount/A.pageSize)+1,rows:A.pageSize});if(A.sortName){$.extend(C,{sort:A.sortName,order:A.sortOrder})}if(A.onBeforeLoad.call(E,C)==false){return}$(E).datagrid("loading");var H=A.loader.call(E,C,function(J){$(E).datagrid("loaded");var J=A.loadFilter.call(E,J);A.onFetch.call(E,F,J.rows);if(J.rows&&J.rows.length){B.data.rows=B.data.rows.concat(J.rows);G.call(A.view,J.rows)}else{A.onLoadSuccess.call(E,J)}},function(){$(E).datagrid("loaded");A.onLoadError.apply(E,arguments)});if(H==false){$(E).datagrid("loaded");if(!B.data.rows.length){A.onFetch.call(E,F,B.data.rows);A.onLoadSuccess.call(E,B.data)}}}},populate:function(D){var C=$.data(D,"datagrid");var B=C.options;var A=C.dc;if(this.rows.length){this.renderedCount+=this.rows.length;this.render.call(this,D,A.body2,false);this.render.call(this,D,A.body1,true);B.onLoadSuccess.call(D,{total:C.data.total,rows:this.rows})}}});
